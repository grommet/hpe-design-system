import { Anchor, Box, Image } from 'grommet';
import { Example } from '../../layouts';
import { ExampleImagePreview } from '../../components';
import {
  PaginationTableExample,
  TableAnatomy,
  TableExample,
  TableFixedHeaderExample,
  TableMultiSelectExample,
  TableResizeColumnsExample,
  TableSingleSelectExample,
  TableSortable,
  TableSummaryExample,
} from '../../examples';

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  figma="https://www.figma.com/file/XEoIWIlLfcARRIFhkpFCch/HPE-Table-Component?node-id=195%3A0"
  showResponsiveControls={['laptop', 'mobile']}
  template
>
  <TableExample />
</Example>

## What makes up a table?

Tables enable users to accomplish a task by finding records of interest, then take action against them.
They present structured data in a grid, with columns and rows to aid readability, scanability, and show
the meaning of the data.

<TableAnatomy />

**Controls**<br />
Table controls should live above the table and facilitate a user's ability to locate and
take actions against records of interest. A controls section may contain [search and filter
controls](#searching-and-filtering-tables), as well as [action controls](#selecting-multiple-records-and-batch-actions)
such as batch applying settings or data export.

**Table header**<br />
Contain table header cells concisely labeling the column's contents.
Column headers may be enhanced by enabling [sorting](#sorting).

**Table body**<br />
Consists of rows allowing users to scan, read and take action on the data.
Rows may be enhanced by enabling actions such as [record selection](#selecting-single-records) and
navigation to a record's detailed view.

**Table footer**<br />
Optional. Used for presenting summary counts, sums, averages, and other [aggregations](#column-summaries-and-aggregation).

<!--
**Cells**<br />
Commonly contain numerical and textual data, but may also include visuals such as meters,
status indicators, anchors, and buttons.
[Cell variants, actions & behaviors >]()
-->

## When to use

Users interacting with a Table are trying to accomplish one of the following types of tasks.
They are not, however, trying to do all of these tasks at once.
Keeping "what is the user setting out to accompish?" at the center of our mindset helps guide which
table features to include and, more importantly, exclude when we add a Table to our interfaces.

### Finding a specific record

Often, a user's task is to find and take action against a specific record. Whether it be
finding a customer's record to review their chat history, tracking a particular order's
status, etc., the user experience objective is to enable a user to locate that record as
quickly as possible.

- Use Search. This is often the quickest, most efficient method for users to find a record of interest.
- As backup, use sortable columns coupled with paginated results. This combination
  provides users with the knowledge of alpha-numeric range, enabling an
  educated guess as to the record's location in the sort.

<ExampleImagePreview
  label="See finding a specific record"
  href="#searching-and-filtering-tables"
  src="/static/images/Searching_Data_Tables.png"
  alt="Example demonstrating how to find a record of interest with a Table"
/>

### Narrowing a result set

When a user is looking to focus on a group of records sharing similar characteristics,
providing thoughtful filter controls allows for incremental reduction of the table's
result set.

- Provide filter controls.
- Filter control input types should be chosen to best fit the data type and breadth of values.

<ExampleImagePreview
  label="Learn more about providing a great filter experience"
  href="#searching-and-filtering-tables"
  src="/static/images/Filtering_Data_Tables.png"
  alt="Example demonstrating how to find a record of interest with a Table"
/>

### Browsing a result set

Sometimes users are "checking up on things" or do not have specific records
in mind. In this case, they are assessing the state of their records and the
user experience objective is to facilitate the scanning of records to identify
potential outliers or records which the user is unaware need attention or action.

- Use infinite scroll. In this scenario, infinite scroll removes friction,
  allowing users to browse records effortlessly.
- Consider adding column data types such as status indicators or meters
  which call attention to records needing attention.

<ExampleImagePreview
  label="Using infinite scroll with tables"
  href="#use-pagination-or-infinite-scroll-with-tables"
  src="/static/images/Browsing_For_Outliers.png"
  alt="Example demonstrating how to find a record of interest with a Table"
/>

### Assembling a data set

Distinct from the user objectives above, tables containing data for analytical
purposes deserve distinct treatments as well. While tables are useful for
providing initial "discovery" type insights, such as identifying available attributes
and ranges of values, purpose built tools are often a better choice for conducting
in depth analysis. In this scenario, a table's design should be optimized for
assembling the data set for analysis and easy portability of that data into the
user's preferred analytical tool.

- Provide [filter controls](#searching-and-filtering-tables).
- Filter control input types should be chosen to best fit the data type and breadth of values.
- Provide export capability for users to consume the data in their analytical
  tool of choice.
- Provide aggregate measures in the [table footer](#column-summaries-and-aggregation).
- Organize table columns to group like elements and to keep most important elements to the left.

<!--
## Guidelines
-->

<!--
### How many columns?
The number of columns and rows should be guided by the task the user is setting
out to accomplish.

Generally, if there are more than 5-7 columns in the table, it is a sign that
a single table is trying to solve too many user problems at once. In that case,
consider:
- Are there too many user persona types using this view? If so, are there opportunities
to personalize the view by role?
- What are the user interactions leading up to the table view? Are there opportunities
to improve navigation and build intentful user flows?
- Perhaps, it is unclear as to what the user problem the table is attempting
to solve? A good opportunity for speaking to and learning from end users!

**The Exception**<br />
In an analytical context, where the goal is to assemble a data set and identify patterns
within it, a larger number of columns may be neccessary.

In this context, a Table should facilitate the assembly of the data set and make the set
accessible in a tool specifically designed for analysis.
-->

## Guidelines

### Setting the width of the table

- Use the correct set of columns, prioritizing frequently used ones. Don't add more columns just because the data is there, as this will clutter the table.
- To support readability, make tables only as wide as they need to be and no wider. If the content does not need a large width, prevent the table from stretching.
- Limit the whitespace on individual columns by using size for table columns.
- When the table has the potential to be wider than the screen:
  - Use 'pin' to anchor the primary column to preserve row context.
  - Use horizontal scrolling within the table, as opposed to scrolling at the level of the entire page
- When the table has the potential to be narrower than its layout context:
  - Align it horizontally with the rest of its layout context. Typically, this is aligned to the start of the content as opposed to stretched.
  - Align any header above the table, including heading, search, filter, actions, in the same way. This keeps an actions menu or button in the context of the table and prevents them from being orphaned. However, don't force the header above the table to align its width to the table, as that might compress the contents of the header too much.

  ### Setting the height of a table

- Let the data set the height of the Table. The Table will grow in height as the length of data increases.
- If it is expected a user will want to navigate to a specific portion of the data, pagination should be used. Generally, it is recommended that each page of table results be limited to 20 records. For more information on pagination, read [Pagination guidance].(/components/pagination#when-to-use)
- Do not restrict the height of a table if the page has available space. This may introduce unnecessary scrolling.
- If the height of a Table needs to be restricted, set `overflow=“auto”` on its parent Box to allow the user to scroll through the data.

### Wrapping and truncating

When text exceeds the amount of space available within a table cell, [wrapping](#wrapping) or [truncation](#truncation) may be used depending on your use case. Below are some best practices to consider when implementing.
- For readability, avoid truncating or wrapping text within the first column.
- Keep each cell short and concise, limiting the amount of characters within a cell when possible.
- Minimize the number of included columns by only showing those which are used most frequently.

### Truncation

**Truncation should not be used on headings, numeric values, or statuses.**

Truncation may be applied at the beginning, middle, or end of a piece of data. When choosing where to apply truncation within a string, consider which section of the text is most likely to differentiate the item from others in the column. 

Additional questions to keep in mind when using truncation:

1. How much information loss is acceptable?
2. What impact is caused by any amount of information loss?
3. When creating the data, can it be structured so that a table can truncate it in such way that the information loss is kept to a minimum?

#### Options for Positioning Truncation

**Front-text**

Front-text truncation is when an ellipsis is placed at the beginning of a long string. This is best used when the start of a string is similar to many other cells, such as text containing a common prefix.

**Mid-text**

For recognizability, it may be better to crop the middle of a string. Define the parts of the content which need to be preserved in order to keep recognition high and should not be truncated. This strategy can be used when both the beginning and ends are uniquely identifiable.

**End-text**

End-text truncation is when the ellipsis is placed at the end of the string.

If truncating numerical values is absolutely necessary, use end-text truncation. Additionally, provide a [tooltip](/compontents/tip) to help users view the complete string.

### Wrapping

Wrapping allows long strings of text or words to break and wrap onto subsequent lines.

Wrapping should be used when:
- The entirety of the content must be available at all times.
- Long numerical values need to be displayed.

### Accessibility

To ensure screen readers are able to associate a page heading with a given table, apply an `id` to the Heading and `aria-describedBy` to the DataTable, where the same string value is applied to both attributes. When a screen reader reaches the table, it will announce the Heading content which provides the user with better context about the table data and purpose.

For example, if on the Heading you apply `id="storage-pools-heading"`, on the DataTable you would apply `aria-describedBy="storage-pools-heading"`. In this example, the screen reader would properly associate "Storage Pools" as the description for the table.

```
<Heading id="storage-pools-heading">Storage Pools</Heading>
<DataTable aria-describedBy="storage-pools-heading" />
```

## Table behaviors & actions

### Sorting

Column headers behave as a button and perform the sort action. A caret icon indicates
the directionality and to which column the sort is currently applied.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableSortable.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableSortable />
</Example>

### Resizeable columns

Columns can be resized if a DataTable has the `resizeable` prop applied. Column resizing allows the user to change the width of the header columns. Each column can be resized by
dragging the right side of its header to the left or to the right to expand the column.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableResizeColumnsExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableResizeColumnsExample />
</Example>

### Searching and filtering tables

Complimenatary elements such as search or filters should be guided by the task the user
is setting out to accomplish.

- Looking for a specific record? --> Search.
- Trying to narrow records down to a set of shared characteristics? --> Filter.
- Not quite certain for what I am looking, but I know its general characteristics? --> Filter.

See [Filtering](/templates/filtering) for greater detail.

### Navigation via table

Clicking on a table row takes the user to a context where the most prominent heading matches the primary column text.
This context could either be a page or a modal. In this example, clicking on a table row navigates to a detail page.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableSingleSelectExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableSingleSelectExample />
</Example>

### Selecting multiple records & batch actions

Checkboxes allow for selection of multiple records, which then may apply
batch actions via action control buttons or menus.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableMultiSelectExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableMultiSelectExample />
</Example>

### Paginated

With long sets of data, pagination can help to create a more efficient means of navigating to a specific item or range of items.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/pagination/PaginationTableExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
  template
  height="auto"
>
  <PaginationTableExample />
</Example>

### Fixing header row and/or columns

Fixing or pinning header rows, columns, or footers allow users to track and
maintain context across long and wide data sets.

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableFixedHeaderExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableFixedHeaderExample />
</Example>

### Column summaries & aggregation

<Example
  code="https://raw.githubusercontent.com/grommet/hpe-design-system/master/aries-site/src/examples/components/table/TableSummaryExample.js"
  docs="https://v2.grommet.io/datatable?theme=hpe#props"
  showResponsiveControls={['laptop', 'mobile']}
>
  <TableSummaryExample />
</Example>

### Use pagination or infinite scroll with tables

Should be guided by the task the user is setting out to accomplish.

- Browsing? --> Infinite Scroll
  - Perhaps I am reviewing a customer's account history. I am not looking for
    a particular record, rather I am in scanning mode, trying to get a sense of
    the volume and types of interaction with a customer over time. Infinite Scroll
    creates a nice, frictionless experirence for this to occur.
- Searching for a specific record? --> It depends.
  - Do you have a good search experience? --> Infinite Scroll
  - Do you have a performant API?
  - Do you require page reloads?
  - Is your data structured?
- Do rows have many interactive elements? --> Pagination
  - Be mindful of keyboard users.

<!-- To be added. Placeholders for future content.
### Pagination

### Infinite Scroll

## Table Cells
-->
